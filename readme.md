# irdetect 

## 一、硬件定义

### 1、485串口
- UART1_TX: PA9
- UART1_RX: PA10
- UART1_RTS: PA12

### 2、debug
- UART2_TX: PA2
- UART2_RX: PA3

### 3、红外功能编号1
- LEDG1: PC13_2P(1: 使能， 0：失能)
- LEDR1: PC14_3P(1: 使能， 0：失能)
- OUT1:  PC15_4P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN1:   PF0_5P(1：使能红光 0：禁止红光)

### 4、红外功能编号2
- LEDG2: PF1_6P(1: 使能， 0：失能)
- LEDR2: PC0_8P(1: 使能， 0：失能)
- OUT2:  PC1_9P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN2:   PC2_10P(1：使能红光 0：禁止红光)

### 5、红外功能编号3
- LEDG3: PC3_11P(1: 使能， 0：失能)
- LEDR3: PA0_14P(1: 使能， 0：失能)
- OUT3:  PA1_15P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN3:   PF4_18P(1：使能红光 0：禁止红光)

### 6、红外功能编号4
- LEDG4: PF5_19P(1: 使能， 0：失能)
- LEDR4: PA4_20P(1: 使能， 0：失能)
- OUT4:  PA5_21P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN4:   PA6_22P(1：使能红光 0：禁止红光)

### 7、红外功能编号5
- LEDG5: PA7_23P(1: 使能， 0：失能)
- LEDR5: PC4_24P(1: 使能， 0：失能)
- OUT5:  PC5_25P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN5:   PB0_26P(1：使能红光 0：禁止红光)

### 8、红外功能编号6
- LEDG6: PB1_27P(1: 使能， 0：失能)
- LEDR6: PB2_28P(1: 使能， 0：失能)
- OUT6:  PB10_29P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN6:   PB11_30P(1：使能红光 0：禁止红光)

### 9、红外功能编号7
- LEDG7: PB12_33P(1: 使能， 0：失能)
- LEDR7: PB13_34P(1: 使能， 0：失能)
- OUT7:  PB14_35P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN7:   PB15_36P(1：使能红光 0：禁止红光)

### 10、红外功能编号8
- LEDG8: PC6_37P(1: 使能， 0：失能)
- LEDR8: PC7_38P(1: 使能， 0：失能)
- OUT8:  PC8_39P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN8:   PC9_40P(1：使能红光 0：禁止红光)

### 11、红外功能编号9
- LEDG9: PA8_41P(1: 使能， 0：失能)
- LEDR9: PA11_44P(1: 使能， 0：失能)
- OUT9:  PF6_47P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN9:   PF7_48P(1：使能红光 0：禁止红光)

### 12、红外功能编号10
- LEDG10: PA15_50P(1: 使能， 0：失能)
- LEDR10: PC10_51P(1: 使能， 0：失能)
- OUT10:  PC11_52P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN10:   PC12_53P(1：使能红光 0：禁止红光)

### 13、红外功能编号11
- LEDG11: PD2_54P(1: 使能， 0：失能)
- LEDR11: PB3_55P(1: 使能， 0：失能)
- OUT11:  PB4_56P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN11:   PB5_57P(1：使能红光 0：禁止红光)

### 14、红外功能编号12
- LEDG12: PB6_58P(1: 使能， 0：失能)
- LEDR12: PB7_59P(1: 使能， 0：失能)
- OUT12:  PB8_61P(输入: 1->枪在位（未收到红光） 0->枪不在位（收到红光）)
- EN12:   PB9_62P(1：使能红光 0：禁止红光)

## 二、软件设计

### 1、灯状态
- 0：熄灭
- 1：红灯亮
- 2：绿灯亮
- 3：红灯闪烁
- 4：绿灯闪烁
- 5：红绿灯交替闪烁

### 2、控制类型（不做记忆，默认mcu模式）
- 0：mcu控灯
- 1：上位机控灯

### 3、控制逻辑
- mcu模式：开启红外检测后，枪支在位，绿灯亮，枪支不在位，红灯亮
- 上位机模式：切换位上位机模式时，灯状态不变，接收上位机指令改变灯状态

## 三、协议内容

### 1、单板状态查询
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + UID + 校验码 + 帧尾
AA 10 00 00 0C 00 40 00 4E 57 56 53 03 20 34 30 36 2F C5 55
> - 应答帧：帧头 + 指令 + 操作码 + 数据区长度 + 地址 + 是否开启主动上报 + 波特率 + 通断标志 + 控灯模式 + 灯状态标志 + UID + 校验码 + 帧尾
AA 11 00 00 19 00 01 04 0F FF 00 00 00 00 00 00 00 00 00 40 00 4E 57 56 53 03 20 34 30 36 61 59 55 

### 2、单板控制单端口枪卡灯状态
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 端口号 + 控灯模式(+灯状态) + UID + 校验码 + 帧尾
AA 10 01 00 0E 01 11 00 40 00 4E 57 56 53 03 20 34 30 36 39 BD 55
AA 10 01 00 0E 01 12 00 40 00 4E 57 56 53 03 20 34 30 36 F6 18 55
AA 10 01 00 0E 01 13 00 40 00 4E 57 56 53 03 20 34 30 36 B3 7B 55
AA 10 01 00 0E 01 14 00 40 00 4E 57 56 53 03 20 34 30 36 79 73 55
AA 10 01 00 0E 01 15 00 40 00 4E 57 56 53 03 20 34 30 36 3C 10 55
> - 应答帧：帧头 + 指令 + 操作码 + 数据区长度 + 地址 + 端口号 + 控灯模式（+灯状态）+ UID + 校验码 + 帧尾
AA 11 01 00 0F 00 01 11 00 40 00 4E 57 56 53 03 20 34 30 36 4D E7 55
AA 11 01 00 0F 00 01 12 00 40 00 4E 57 56 53 03 20 34 30 36 82 42 55  

### 3、单板控制所有端口枪卡灯状态
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 控灯模式 +灯状态 + UID + 校验码 + 帧尾
AA 10 02 00 14 05 56 12 34 50 12 34 00 00 40 00 4E 57 56 53 03 20 34 30 36 FE 86 55
> - 应答帧：帧头 + 指令 + 操作码 + 数据区长度 + 地址 + 控灯模式 + 灯状态 + UID + 校验码 + 帧尾
AA 11 02 00 14 00 56 12 34 50 12 34 00 00 40 00 4E 57 56 53 03 20 34 30 36 2A FA 55 

### 4、单板取还枪上报
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 端口号 + 报警类型 + 控灯模式（+灯状态）+ UID + 校验码 + 帧尾
> - 应答帧：无

### 5、单板基础设置
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 地址 + 是否开启主动上报 + UID + 校验码 + 帧尾
AA 10 04 00 0E 01 01 00 40 00 4E 57 56 53 03 20 34 30 36 7C 63 55
> - 应答帧：帧头 + 指令 + 操作码 + 数据区长度 + 地址 + 是否开启主动上报 + UID + 校验码 + 帧尾
AA 11 04 00 0E 01 01 00 40 00 4E 57 56 53 03 20 34 30 36 8C 52 55 

### 6、批量启用与关闭主动上报指令
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 是否开启主动上报 + 校验码 + 帧尾
AA 10 05 00 01 01 9B 0F 55
AA 10 05 00 01 00 8B 2E 55
> - 应答帧：无

### 7、批量控制单端口枪卡灯状态
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 端口号 + 控灯模式（+灯状态） + 校验码 + 帧尾
AA 10 06 00 02 01 11 88 40 55
> - 应答帧：无

### 8、批量控制所有端口枪卡灯状态
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 控灯模式 +灯状态 + 校验码 + 帧尾
AA 10 07 00 08 0F FF 11 22 33 44 45 11 DE C3 55
> - 应答帧：无

### 9、上报地址与UID
> - 请求帧：帧头 + 指令 + 操作码 + 数据区长度 + 地址 + 板开关状态 + UID + 校验码 + 帧尾
AA 10 08 00 0E 01 01 00 40 00 4E 57 56 53 03 20 34 30 36 B8 FB 55 
> - 应答帧：无


